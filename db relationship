ğŸ—ƒï¸ Complete Database Schema & Relationships - Blife Platform

ğŸ“Š Database Architecture Overview

1. User Management & Authentication

```sql
-- Users table
users
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name
â”œâ”€â”€ email
â”œâ”€â”€ password
â”œâ”€â”€ role (enum: customer, seller, admin)
â”œâ”€â”€ email_verified_at
â”œâ”€â”€ phone
â”œâ”€â”€ avatar
â”œâ”€â”€ is_active
â”œâ”€â”€ last_login_at
â”œâ”€â”€ created_at
â”œâ”€â”€ updated_at
â””â”€â”€ remember_token

-- Seller profiles
sellers
â”œâ”€â”€ id (PK)
â”œâ”€â”€ user_id (FK â†’ users)
â”œâ”€â”€ shop_name
â”œâ”€â”€ shop_slug
â”œâ”€â”€ shop_description
â”œâ”€â”€ shop_logo
â”œâ”€â”€ shop_banner
â”œâ”€â”€ shop_category_id (FK â†’ categories)
â”œâ”€â”€ bank_name
â”œâ”€â”€ account_number
â”œâ”€â”€ account_name
â”œâ”€â”€ tax_id
â”œâ”€â”€ status (enum: pending, approved, rejected, suspended)
â”œâ”€â”€ approval_status
â”œâ”€â”€ approved_at
â”œâ”€â”€ commission_rate (default: platform setting)
â”œâ”€â”€ total_earnings
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- User addresses
addresses
â”œâ”€â”€ id (PK)
â”œâ”€â”€ user_id (FK â†’ users)
â”œâ”€â”€ type (enum: billing, shipping)
â”œâ”€â”€ address_line_1
â”œâ”€â”€ address_line_2
â”œâ”€â”€ province_id (FK â†’ provinces)
â”œâ”€â”€ district_id (FK â†’ districts)
â”œâ”€â”€ subdistrict_id (FK â†’ subdistricts)
â”œâ”€â”€ zipcode
â”œâ”€â”€ is_default
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
```

2. Product & Catalog Management

```sql
-- Categories
categories
â”œâ”€â”€ id (PK)
â”œâ”€â”€ parent_id (FK â†’ categories, self-referential)
â”œâ”€â”€ name
â”œâ”€â”€ slug
â”œâ”€â”€ description
â”œâ”€â”€ image
â”œâ”€â”€ meta_title
â”œâ”€â”€ meta_description
â”œâ”€â”€ is_active
â”œâ”€â”€ order
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Products
products
â”œâ”€â”€ id (PK)
â”œâ”€â”€ seller_id (FK â†’ sellers)
â”œâ”€â”€ category_id (FK â†’ categories)
â”œâ”€â”€ name
â”œâ”€â”€ slug
â”œâ”€â”€ description
â”œâ”€â”€ short_description
â”œâ”€â”€ price
â”œâ”€â”€ compare_price
â”œâ”€â”€ cost_price
â”œâ”€â”€ sku
â”œâ”€â”€ barcode
â”œâ”€â”€ weight
â”œâ”€â”€ dimensions (JSON: {width, height, length})
â”œâ”€â”€ is_published
â”œâ”€â”€ is_featured
â”œâ”€â”€ is_digital
â”œâ”€â”€ requires_shipping
â”œâ”€â”€ track_quantity
â”œâ”€â”€ quantity
â”œâ”€â”€ low_stock_threshold
â”œâ”€â”€ meta_title
â”œâ”€â”€ meta_description
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Product variants
product_variants
â”œâ”€â”€ id (PK)
â”œâ”€â”€ product_id (FK â†’ products)
â”œâ”€â”€ name (e.g., "Color", "Size")
â”œâ”€â”€ value (e.g., "Red", "XL")
â”œâ”€â”€ price_adjustment
â”œâ”€â”€ sku
â”œâ”€â”€ quantity
â”œâ”€â”€ image
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Product images
product_images
â”œâ”€â”€ id (PK)
â”œâ”€â”€ product_id (FK â†’ products)
â”œâ”€â”€ variant_id (FK â†’ product_variants, nullable)
â”œâ”€â”€ image_path
â”œâ”€â”€ alt_text
â”œâ”€â”€ order
â”œâ”€â”€ is_primary
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Inventory management
inventory_logs
â”œâ”€â”€ id (PK)
â”œâ”€â”€ product_id (FK â†’ products)
â”œâ”€â”€ variant_id (FK â†’ product_variants, nullable)
â”œâ”€â”€ type (enum: in, out, adjustment)
â”œâ”€â”€ quantity
â”œâ”€â”€ reason
â”œâ”€â”€ note
â”œâ”€â”€ created_by (FK â†’ users)
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
```

3. Order & Payment System

```sql
-- Orders
orders
â”œâ”€â”€ id (PK)
â”œâ”€â”€ user_id (FK â†’ users)
â”œâ”€â”€ code (unique order number)
â”œâ”€â”€ status (enum: pending, confirmed, processing, shipped, delivered, cancelled, refunded)
â”œâ”€â”€ payment_status (enum: pending, paid, failed, refunded)
â”œâ”€â”€ shipping_address_id (FK â†’ addresses)
â”œâ”€â”€ billing_address_id (FK â†’ addresses)
â”œâ”€â”€ shipping_method
â”œâ”€â”€ shipping_cost
â”œâ”€â”€ subtotal
â”œâ”€â”€ tax_amount
â”œâ”€â”€ discount_amount
â”œâ”€â”€ total
â”œâ”€â”€ note
â”œâ”€â”€ cancelled_at
â”œâ”€â”€ shipped_at
â”œâ”€â”€ delivered_at
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Order items
order_items
â”œâ”€â”€ id (PK)
â”œâ”€â”€ order_id (FK â†’ orders)
â”œâ”€â”€ product_id (FK â†’ products)
â”œâ”€â”€ variant_id (FK â†’ product_variants, nullable)
â”œâ”€â”€ product_name (snapshot)
â”œâ”€â”€ variant_name (snapshot)
â”œâ”€â”€ quantity
â”œâ”€â”€ unit_price
â”œâ”€â”€ total_price
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Vendor orders (split by seller)
vendor_orders
â”œâ”€â”€ id (PK)
â”œâ”€â”€ order_id (FK â†’ orders)
â”œâ”€â”€ seller_id (FK â†’ sellers)
â”œâ”€â”€ status (enum: pending, confirmed, processing, shipped, delivered, cancelled)
â”œâ”€â”€ subtotal
â”œâ”€â”€ shipping_cost
â”œâ”€â”€ commission_amount
â”œâ”€â”€ seller_earnings
â”œâ”€â”€ shipping_tracking_number
â”œâ”€â”€ shipped_at
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Vendor order items
vendor_order_items
â”œâ”€â”€ id (PK)
â”œâ”€â”€ vendor_order_id (FK â†’ vendor_orders)
â”œâ”€â”€ order_item_id (FK â†’ order_items)
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Transactions
transactions
â”œâ”€â”€ id (PK)
â”œâ”€â”€ order_id (FK â†’ orders)
â”œâ”€â”€ payment_method (enum: credit_card, bank_transfer, promptpay, cash)
â”œâ”€â”€ payment_gateway
â”œâ”€â”€ gateway_transaction_id
â”œâ”€â”€ amount
â”œâ”€â”€ fee
â”œâ”€â”€ status (enum: pending, completed, failed, refunded)
â”œâ”€â”€ gateway_response (JSON)
â”œâ”€â”€ paid_at
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
```

4. â­ MLM Snowball System

```sql
-- Snowball packages
snowball_packages
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name (Basic, Pro, Enterprise)
â”œâ”€â”€ slug
â”œâ”€â”€ description
â”œâ”€â”€ formula (e.g., "pv * commission_rate / 100")
â”œâ”€â”€ variables (JSON: configurable variables)
â”œâ”€â”€ monthly_fee
â”œâ”€â”€ product_limit
â”œâ”€â”€ is_active
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Product snowball settings
product_snowball_settings
â”œâ”€â”€ id (PK)
â”œâ”€â”€ product_id (FK â†’ products)
â”œâ”€â”€ snowball_package_id (FK â†’ snowball_packages)
â”œâ”€â”€ is_active
â”œâ”€â”€ input_values (JSON: vendor-provided values)
â”œâ”€â”€ pv (Point Value)
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Commission logs
snowball_commission_logs
â”œâ”€â”€ id (PK)
â”œâ”€â”€ seller_id (FK â†’ sellers)
â”œâ”€â”€ product_snowball_setting_id (FK â†’ product_snowball_settings)
â”œâ”€â”€ order_id (FK â†’ orders)
â”œâ”€â”€ vendor_order_id (FK â†’ vendor_orders)
â”œâ”€â”€ snowball_package_id (FK â†’ snowball_packages)
â”œâ”€â”€ commission_amount
â”œâ”€â”€ calculation_formula
â”œâ”€â”€ calculated_values (JSON)
â”œâ”€â”€ mlm_api_reference
â”œâ”€â”€ status (enum: pending, approved, paid)
â”œâ”€â”€ paid_at
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Payouts
payouts
â”œâ”€â”€ id (PK)
â”œâ”€â”€ seller_id (FK â†’ sellers)
â”œâ”€â”€ amount
â”œâ”€â”€ status (enum: pending, processing, paid, failed)
â”œâ”€â”€ payment_method
â”œâ”€â”€ payment_reference
â”œâ”€â”€ paid_at
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Payout items
payout_items
â”œâ”€â”€ id (PK)
â”œâ”€â”€ payout_id (FK â†’ payouts)
â”œâ”€â”€ commission_log_id (FK â†’ snowball_commission_logs)
â”œâ”€â”€ amount
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
```

5. Content & Reviews System

```sql
-- Reviews
reviews
â”œâ”€â”€ id (PK)
â”œâ”€â”€ product_id (FK â†’ products)
â”œâ”€â”€ user_id (FK â†’ users)
â”œâ”€â”€ order_id (FK â†’ orders)
â”œâ”€â”€ rating (1-5)
â”œâ”€â”€ title
â”œâ”€â”€ comment
â”œâ”€â”€ is_approved
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Review images
review_images
â”œâ”€â”€ id (PK)
â”œâ”€â”€ review_id (FK â†’ reviews)
â”œâ”€â”€ image_path
â”œâ”€â”€ order
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Wishlist
wishlists
â”œâ”€â”€ id (PK)
â”œâ”€â”€ user_id (FK â†’ users)
â”œâ”€â”€ product_id (FK â†’ products)
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Blog system
blog_categories
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name
â”œâ”€â”€ slug
â”œâ”€â”€ description
â”œâ”€â”€ is_active
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

blog_posts
â”œâ”€â”€ id (PK)
â”œâ”€â”€ author_id (FK â†’ users)
â”œâ”€â”€ category_id (FK â†’ blog_categories)
â”œâ”€â”€ title
â”œâ”€â”€ slug
â”œâ”€â”€ excerpt
â”œâ”€â”€ content
â”œâ”€â”€ featured_image
â”œâ”€â”€ meta_title
â”œâ”€â”€ meta_description
â”œâ”€â”€ is_published
â”œâ”€â”€ published_at
â”œâ”€â”€ views_count
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

blog_post_tags
â”œâ”€â”€ id (PK)
â”œâ”€â”€ post_id (FK â†’ blog_posts)
â”œâ”€â”€ tag_id (FK â†’ blog_tags)
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

blog_tags
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name
â”œâ”€â”€ slug
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
```

6. Support & Communication

```sql
-- Support tickets
tickets
â”œâ”€â”€ id (PK)
â”œâ”€â”€ user_id (FK â†’ users)
â”œâ”€â”€ seller_id (FK â†’ sellers, nullable)
â”œâ”€â”€ subject
â”œâ”€â”€ message
â”œâ”€â”€ status (enum: open, in_progress, resolved, closed)
â”œâ”€â”€ priority (enum: low, medium, high, urgent)
â”œâ”€â”€ assigned_to (FK â†’ users, nullable)
â”œâ”€â”€ resolved_at
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Ticket replies
ticket_replies
â”œâ”€â”€ id (PK)
â”œâ”€â”€ ticket_id (FK â†’ tickets)
â”œâ”€â”€ user_id (FK â†’ users)
â”œâ”€â”€ message
â”œâ”€â”€ is_internal_note
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Ticket attachments
ticket_attachments
â”œâ”€â”€ id (PK)
â”œâ”€â”€ ticket_reply_id (FK â†’ ticket_replies)
â”œâ”€â”€ file_path
â”œâ”€â”€ file_name
â”œâ”€â”€ file_size
â”œâ”€â”€ mime_type
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
```

7. System & Configuration

```sql
-- System settings
system_settings
â”œâ”€â”€ id (PK)
â”œâ”€â”€ key
â”œâ”€â”€ value (JSON)
â”œâ”€â”€ type (enum: string, number, boolean, json, array)
â”œâ”€â”€ group (general, payment, shipping, email, mlm)
â”œâ”€â”€ is_public
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Service integrations
service_integrations
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name
â”œâ”€â”€ service_key
â”œâ”€â”€ service_type (enum: payment, shipping, mlm, email, sms)
â”œâ”€â”€ is_enabled
â”œâ”€â”€ credentials (JSON, encrypted)
â”œâ”€â”€ settings (JSON)
â”œâ”€â”€ last_checked_at
â”œâ”€â”€ last_success_at
â”œâ”€â”€ success_count
â”œâ”€â”€ failure_count
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Service logs
service_logs
â”œâ”€â”€ id (PK)
â”œâ”€â”€ service_integration_id (FK â†’ service_integrations)
â”œâ”€â”€ type (enum: request, response, error, info)
â”œâ”€â”€ message
â”œâ”€â”€ data (JSON)
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- Thai address data
provinces
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name_th
â”œâ”€â”€ name_en
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

districts
â”œâ”€â”€ id (PK)
â”œâ”€â”€ province_id (FK â†’ provinces)
â”œâ”€â”€ name_th
â”œâ”€â”€ name_en
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

subdistricts
â”œâ”€â”€ id (PK)
â”œâ”€â”€ district_id (FK â†’ districts)
â”œâ”€â”€ name_th
â”œâ”€â”€ name_en
â”œâ”€â”€ zipcode
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
```

---

ğŸš€ Database Migrations

1. Users Migration

```php
<?php
// database/migrations/2024_01_01_000000_create_users_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up()
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->enum('role', ['customer', 'seller', 'admin'])->default('customer');
            $table->string('phone')->nullable();
            $table->string('avatar')->nullable();
            $table->boolean('is_active')->default(true);
            $table->timestamp('last_login_at')->nullable();
            $table->rememberToken();
            $table->timestamps();
        });
    }

    public function down()
    {
        Schema::dropIfExists('users');
    }
};
```

2. Sellers Migration

```php
<?php
// database/migrations/2024_01_01_000001_create_sellers_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up()
    {
        Schema::create('sellers', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->string('shop_name');
            $table->string('shop_slug')->unique();
            $table->text('shop_description')->nullable();
            $table->string('shop_logo')->nullable();
            $table->string('shop_banner')->nullable();
            $table->foreignId('shop_category_id')->nullable()->constrained('categories');
            $table->string('bank_name');
            $table->string('account_number');
            $table->string('account_name');
            $table->string('tax_id')->nullable();
            $table->enum('status', ['pending', 'approved', 'rejected', 'suspended'])->default('pending');
            $table->text('approval_status')->nullable();
            $table->timestamp('approved_at')->nullable();
            $table->decimal('commission_rate', 5, 2)->default(0);
            $table->decimal('total_earnings', 15, 2)->default(0);
            $table->timestamps();
        });
    }

    public function down()
    {
        Schema::dropIfExists('sellers');
    }
};
```

3. Snowball Packages Migration

```php
<?php
// database/migrations/2024_01_01_000002_create_snowball_packages_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up()
    {
        Schema::create('snowball_packages', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('slug')->unique();
            $table->text('description')->nullable();
            $table->text('formula'); // Commission calculation formula
            $table->json('variables'); // Configurable variables for the formula
            $table->decimal('monthly_fee', 10, 2)->default(0);
            $table->integer('product_limit')->default(0); // 0 = unlimited
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });
    }

    public function down()
    {
        Schema::dropIfExists('snowball_packages');
    }
};
```

4. Product Snowball Settings Migration

```php
<?php
// database/migrations/2024_01_01_000003_create_product_snowball_settings_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up()
    {
        Schema::create('product_snowball_settings', function (Blueprint $table) {
            $table->id();
            $table->foreignId('product_id')->constrained()->onDelete('cascade');
            $table->foreignId('snowball_package_id')->constrained()->onDelete('cascade');
            $table->boolean('is_active')->default(true);
            $table->json('input_values'); // Vendor-provided values for variables
            $table->decimal('pv', 10, 2)->default(0); // Point Value
            $table->timestamps();
            
            $table->unique(['product_id', 'snowball_package_id']);
        });
    }

    public function down()
    {
        Schema::dropIfExists('product_snowball_settings');
    }
};
```

---

ğŸŒ± Database Seeders

1. Database Seeder

```php
<?php
// database/seeders/DatabaseSeeder.php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    public function run()
    {
        $this->call([
            RoleSeeder::class,
            UserSeeder::class,
            CategorySeeder::class,
            SnowballPackageSeeder::class,
            SystemSettingSeeder::class,
            ServiceIntegrationSeeder::class,
            ThaiAddressSeeder::class,
        ]);
    }
}
```

2. Snowball Package Seeder

```php
<?php
// database/seeders/SnowballPackageSeeder.php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;

class SnowballPackageSeeder extends Seeder
{
    public function run()
    {
        $packages = [
            [
                'name' => 'Basic Snowball',
                'slug' => 'basic-snowball',
                'description' => 'à¹à¸à¹‡à¸„à¹€à¸à¸ˆà¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸‚à¸²à¸¢à¹ƒà¸«à¸¡à¹ˆ à¸Ÿà¸£à¸µà¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢',
                'formula' => 'pv * commission_rate / 100',
                'variables' => json_encode([
                    'pv' => [
                        'type' => 'number',
                        'label' => 'Point Value (PV)',
                        'required' => true,
                        'min' => 0,
                        'max' => 100000
                    ],
                    'commission_rate' => [
                        'type' => 'number',
                        'label' => 'Commission Rate (%)',
                        'required' => true,
                        'default' => 10,
                        'min' => 1,
                        'max' => 50
                    ]
                ]),
                'monthly_fee' => 0,
                'product_limit' => 10,
                'is_active' => true,
                'created_at' => now(),
                'updated_at' => now(),
            ],
            [
                'name' => 'Pro Snowball',
                'slug' => 'pro-snowball',
                'description' => 'à¹à¸à¹‡à¸„à¹€à¸à¸ˆà¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸‚à¸²à¸¢à¸£à¸°à¸”à¸±à¸šà¸¡à¸·à¸­à¸­à¸²à¸Šà¸µà¸ à¸¡à¸µà¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œà¸„à¸£à¸šà¸„à¸£à¸±à¸™',
                'formula' => '((pv * bv_multiplier) + base_commission) * level_multiplier',
                'variables' => json_encode([
                    'pv' => [
                        'type' => 'number',
                        'label' => 'Point Value (PV)',
                        'required' => true,
                        'min' => 0,
                        'max' => 100000
                    ],
                    'bv_multiplier' => [
                        'type' => 'number',
                        'label' => 'BV Multiplier',
                        'required' => true,
                        'default' => 1.5,
                        'min' => 1,
                        'max' => 5
                    ],
                    'base_commission' => [
                        'type' => 'number',
                        'label' => 'Base Commission',
                        'required' => true,
                        'default' => 50,
                        'min' => 0,
                        'max' => 1000
                    ],
                    'level_multiplier' => [
                        'type' => 'select',
                        'label' => 'Level Multiplier',
                        'required' => true,
                        'options' => [
                            '1x' => 1,
                            '1.2x' => 1.2,
                            '1.5x' => 1.5,
                            '1.8x' => 1.8,
                            '2x' => 2
                        ],
                        'default' => 1
                    ]
                ]),
                'monthly_fee' => 299,
                'product_limit' => 50,
                'is_active' => true,
                'created_at' => now(),
                'updated_at' => now(),
            ],
            [
                'name' => 'Enterprise Snowball',
                'slug' => 'enterprise-snowball',
                'description' => 'à¹à¸à¹‡à¸„à¹€à¸à¸ˆà¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸‚à¸²à¸¢à¸£à¸°à¸”à¸±à¸šà¸­à¸‡à¸„à¹Œà¸à¸£ à¹„à¸¡à¹ˆà¸ˆà¸³à¸à¸±à¸”à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™',
                'formula' => '(pv * stype_multiplier * rank_bonus) + (team_volume * team_commission_rate / 100)',
                'variables' => json_encode([
                    'pv' => [
                        'type' => 'number',
                        'label' => 'Point Value (PV)',
                        'required' => true,
                        'min' => 0,
                        'max' => 100000
                    ],
                    'stype_multiplier' => [
                        'type' => 'select',
                        'label' => 'Sales Type Multiplier',
                        'required' => true,
                        'options' => [
                            'Type A (1x)' => 1,
                            'Type B (1.3x)' => 1.3,
                            'Type C (1.5x)' => 1.5,
                            'Type D (2x)' => 2
                        ],
                        'default' => 1
                    ],
                    'rank_bonus' => [
                        'type' => 'select',
                        'label' => 'Rank Bonus',
                        'required' => true,
                        'options' => [
                            'Member (1x)' => 1,
                            'Silver (1.2x)' => 1.2,
                            'Gold (1.5x)' => 1.5,
                            'Platinum (2x)' => 2,
                            'Crown (2.5x)' => 2.5
                        ],
                        'default' => 1
                    ],
                    'team_volume' => [
                        'type' => 'number',
                        'label' => 'Team Volume',
                        'required' => false,
                        'default' => 0,
                        'min' => 0,
                        'max' => 10000000
                    ],
                    'team_commission_rate' => [
                        'type' => 'number',
                        'label' => 'Team Commission Rate (%)',
                        'required' => true,
                        'default' => 3,
                        'min' => 1,
                        'max' => 10
                    ]
                ]),
                'monthly_fee' => 999,
                'product_limit' => 0, // Unlimited
                'is_active' => true,
                'created_at' => now(),
                'updated_at' => now(),
            ]
        ];

        DB::table('snowball_packages')->insert($packages);
    }
}
```

3. User Seeder

```php
<?php
// database/seeders/UserSeeder.php

namespace Database\Seeders;

use App\Models\User;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\Hash;

class UserSeeder extends Seeder
{
    public function run()
    {
        // Create Admin User
        User::create([
            'name' => 'System Admin',
            'email' => 'admin@blife.com',
            'password' => Hash::make('password'),
            'role' => 'admin',
            'email_verified_at' => now(),
            'phone' => '0812345678',
            'is_active' => true,
        ]);

        // Create Sample Seller
        $sellerUser = User::create([
            'name' => 'John Seller',
            'email' => 'seller@blife.com',
            'password' => Hash::make('password'),
            'role' => 'seller',
            'email_verified_at' => now(),
            'phone' => '0823456789',
            'is_active' => true,
        ]);

        // Create seller profile
        $sellerUser->seller()->create([
            'shop_name' => 'John\'s Fashion Store',
            'shop_slug' => 'johns-fashion-store',
            'shop_description' => 'à¸£à¹‰à¸²à¸™à¸‚à¸²à¸¢à¹€à¸ªà¸·à¹‰à¸­à¸œà¹‰à¸²à¹à¸Ÿà¸Šà¸±à¹ˆà¸™à¸„à¸¸à¸“à¸ à¸²à¸à¸ªà¸¹à¸‡à¸ˆà¸²à¸ John',
            'bank_name' => 'KBANK',
            'account_number' => '1234567890',
            'account_name' => 'John Seller',
            'status' => 'approved',
            'approved_at' => now(),
            'commission_rate' => 15.00,
        ]);

        // Create Sample Customer
        User::create([
            'name' => 'Jane Customer',
            'email' => 'customer@blife.com',
            'password' => Hash::make('password'),
            'role' => 'customer',
            'email_verified_at' => now(),
            'phone' => '0834567890',
            'is_active' => true,
        ]);

        // Create multiple customers for testing
        User::factory()->count(50)->create(['role' => 'customer']);
        
        // Create multiple sellers for testing
        User::factory()->count(10)->create(['role' => 'seller'])->each(function ($user) {
            $user->seller()->create([
                'shop_name' => fake()->company() . ' Store',
                'shop_slug' => \Illuminate\Support\Str::slug(fake()->company() . ' Store'),
                'shop_description' => fake()->paragraph(),
                'bank_name' => fake()->randomElement(['KBANK', 'SCB', 'BBL', 'KTB']),
                'account_number' => fake()->numerify('############'),
                'account_name' => $user->name,
                'status' => fake()->randomElement(['approved', 'pending']),
                'commission_rate' => fake()->randomFloat(2, 10, 30),
            ]);
        });
    }
}
```

---

ğŸ­ Model Factories

1. User Factory

```php
<?php
// database/factories/UserFactory.php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

class UserFactory extends Factory
{
    public function definition()
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => Hash::make('password'),
            'role' => 'customer',
            'phone' => fake()->numerify('08#######'),
            'avatar' => null,
            'is_active' => true,
            'remember_token' => Str::random(10),
        ];
    }

    public function admin()
    {
        return $this->state(fn (array $attributes) => [
            'role' => 'admin',
        ]);
    }

    public function seller()
    {
        return $this->state(fn (array $attributes) => [
            'role' => 'seller',
        ]);
    }

    public function customer()
    {
        return $this->state(fn (array $attributes) => [
            'role' => 'customer',
        ]);
    }

    public function unverified()
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }

    public function inactive()
    {
        return $this->state(fn (array $attributes) => [
            'is_active' => false,
        ]);
    }
}
```

2. Product Factory

```php
<?php
// database/factories/ProductFactory.php

namespace Database\Factories;

use App\Models\Seller;
use App\Models\Category;
use Illuminate\Database\Eloquent\Factories\Factory;

class ProductFactory extends Factory
{
    public function definition()
    {
        $price = fake()->numberBetween(100, 5000);
        $comparePrice = $price + fake()->numberBetween(100, 1000);

        return [
            'seller_id' => Seller::factory(),
            'category_id' => Category::factory(),
            'name' => fake()->words(3, true),
            'slug' => fn (array $attributes) => \Illuminate\Support\Str::slug($attributes['name']),
            'description' => fake()->paragraphs(3, true),
            'short_description' => fake()->sentence(),
            'price' => $price,
            'compare_price' => $comparePrice,
            'cost_price' => $price * 0.6,
            'sku' => fake()->unique()->bothify('SKU-#####'),
            'barcode' => fake()->isbn13(),
            'weight' => fake()->randomFloat(2, 0.1, 10),
            'dimensions' => json_encode([
                'width' => fake()->randomFloat(2, 10, 50),
                'height' => fake()->randomFloat(2, 10, 50),
                'length' => fake()->randomFloat(2, 10, 50),
            ]),
            'is_published' => true,
            'is_featured' => fake()->boolean(20),
            'is_digital' => false,
            'requires_shipping' => true,
            'track_quantity' => true,
            'quantity' => fake()->numberBetween(0, 100),
            'low_stock_threshold' => 10,
            'meta_title' => fn (array $attributes) => $attributes['name'],
            'meta_description' => fn (array $attributes) => $attributes['short_description'],
        ];
    }

    public function published()
    {
        return $this->state(fn (array $attributes) => [
            'is_published' => true,
        ]);
    }

    public function unpublished()
    {
        return $this->state(fn (array $attributes) => [
            'is_published' => false,
        ]);
    }

    public function featured()
    {
        return $this->state(fn (array $attributes) => [
            'is_featured' => true,
        ]);
    }

    public function digital()
    {
        return $this->state(fn (array $attributes) => [
            'is_digital' => true,
            'requires_shipping' => false,
            'weight' => 0,
            'dimensions' => json_encode(['width' => 0, 'height' => 0, 'length' => 0]),
        ]);
    }

    public function outOfStock()
    {
        return $this->state(fn (array $attributes) => [
            'quantity' => 0,
        ]);
    }

    public function lowStock()
    {
        return $this->state(fn (array $attributes) => [
            'quantity' => fake()->numberBetween(1, 10),
        ]);
    }
}
```

3. Order Factory

```php
<?php
// database/factories/OrderFactory.php

namespace Database\Factories;

use App\Models\User;
use App\Models\Address;
use Illuminate\Database\Eloquent\Factories\Factory;

class OrderFactory extends Factory
{
    public function definition()
    {
        $subtotal = fake()->numberBetween(500, 5000);
        $shippingCost = fake()->numberBetween(30, 100);
        $taxAmount = $subtotal * 0.07;
        $total = $subtotal + $shippingCost + $taxAmount;

        return [
            'user_id' => User::factory(),
            'code' => 'ORD-' . fake()->unique()->numerify('########'),
            'status' => fake()->randomElement(['pending', 'confirmed', 'processing', 'shipped', 'delivered']),
            'payment_status' => fake()->randomElement(['pending', 'paid', 'failed']),
            'shipping_address_id' => Address::factory(),
            'billing_address_id' => Address::factory(),
            'shipping_method' => fake()->randomElement(['kerry', 'flash', 'ems', 'registered']),
            'shipping_cost' => $shippingCost,
            'subtotal' => $subtotal,
            'tax_amount' => $taxAmount,
            'discount_amount' => 0,
            'total' => $total,
            'note' => fake()->boolean(30) ? fake()->sentence() : null,
            'shipped_at' => fn (array $attributes) => 
                in_array($attributes['status'], ['shipped', 'delivered']) ? now() : null,
            'delivered_at' => fn (array $attributes) => 
                $attributes['status'] === 'delivered' ? now() : null,
        ];
    }

    public function pending()
    {
        return $this->state(fn (array $attributes) => [
            'status' => 'pending',
            'payment_status' => 'pending',
        ]);
    }

    public function paid()
    {
        return $this->state(fn (array $attributes) => [
            'payment_status' => 'paid',
        ]);
    }

    public function delivered()
    {
        return $this->state(fn (array $attributes) => [
            'status' => 'delivered',
            'shipped_at' => now()->subDays(3),
            'delivered_at' => now()->subDays(1),
        ]);
    }

    public function withDiscount($amount)
    {
        return $this->state(fn (array $attributes) => [
            'discount_amount' => $amount,
            'total' => $attributes['subtotal'] + $attributes['shipping_cost'] + $attributes['tax_amount'] - $amount,
        ]);
    }
}
```

---

ğŸ”— Eloquent Relationships

1. User Model Relationships

```php
<?php
// app/Models/User.php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
    use Notifiable;

    protected $fillable = [
        'name', 'email', 'password', 'role', 'phone', 'avatar', 'is_active'
    ];

    protected $hidden = [
        'password', 'remember_token',
    ];

    protected $casts = [
        'email_verified_at' => 'datetime',
        'last_login_at' => 'datetime',
        'is_active' => 'boolean',
    ];

    // Relationships
    public function seller()
    {
        return $this->hasOne(Seller::class);
    }

    public function addresses()
    {
        return $this->hasMany(Address::class);
    }

    public function orders()
    {
        return $this->hasMany(Order::class);
    }

    public function reviews()
    {
        return $this->hasMany(Review::class);
    }

    public function wishlist()
    {
        return $this->hasMany(Wishlist::class);
    }

    public function tickets()
    {
        return $this->hasMany(Ticket::class);
    }

    public function assignedTickets()
    {
        return $this->hasMany(Ticket::class, 'assigned_to');
    }

    public function ticketReplies()
    {
        return $this->hasMany(TicketReply::class);
    }

    // Scopes
    public function scopeCustomers($query)
    {
        return $query->where('role', 'customer');
    }

    public function scopeSellers($query)
    {
        return $query->where('role', 'seller');
    }

    public function scopeAdmins($query)
    {
        return $query->where('role', 'admin');
    }

    public function scopeActive($query)
    {
        return $query->where('is_active', true);
    }

    // Methods
    public function isAdmin()
    {
        return $this->role === 'admin';
    }

    public function isSeller()
    {
        return $this->role === 'seller';
    }

    public function isCustomer()
    {
        return $this->role === 'customer';
    }

    public function hasSellerProfile()
    {
        return $this->seller()->exists();
    }

    public function getAvatarUrlAttribute()
    {
        return $this->avatar ? asset('storage/' . $this->avatar) : asset('images/placeholders/avatar-placeholder.png');
    }
}
```

2. Product Model with Snowball Relationship

```php
<?php
// app/Models/Product.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class Product extends Model
{
    use HasFactory;

    protected $fillable = [
        'seller_id', 'category_id', 'name', 'slug', 'description', 'short_description',
        'price', 'compare_price', 'cost_price', 'sku', 'barcode', 'weight', 'dimensions',
        'is_published', 'is_featured', 'is_digital', 'requires_shipping', 'track_quantity',
        'quantity', 'low_stock_threshold', 'meta_title', 'meta_description'
    ];

    protected $casts = [
        'price' => 'decimal:2',
        'compare_price' => 'decimal:2',
        'cost_price' => 'decimal:2',
        'weight' => 'decimal:2',
        'dimensions' => 'array',
        'is_published' => 'boolean',
        'is_featured' => 'boolean',
        'is_digital' => 'boolean',
        'requires_shipping' => 'boolean',
        'track_quantity' => 'boolean',
        'quantity' => 'integer',
        'low_stock_threshold' => 'integer',
    ];

    // Relationships
    public function seller()
    {
        return $this->belongsTo(Seller::class);
    }

    public function category()
    {
        return $this->belongsTo(Category::class);
    }

    public function variants()
    {
        return $this->hasMany(ProductVariant::class);
    }

    public function images()
    {
        return $this->hasMany(ProductImage::class);
    }

    public function reviews()
    {
        return $this->hasMany(Review::class);
    }

    public function wishlists()
    {
        return $this->hasMany(Wishlist::class);
    }

    public function orderItems()
    {
        return $this->hasMany(OrderItem::class);
    }

    // â­ Snowball MLM Relationship
    public function snowballSetting()
    {
        return $this->hasOne(ProductSnowballSetting::class);
    }

    public function snowballPackage()
    {
        return $this->hasOneThrough(
            SnowballPackage::class,
            ProductSnowballSetting::class,
            'product_id', // Foreign key on product_snowball_settings table
            'id', // Foreign key on snowball_packages table
            'id', // Local key on products table
            'snowball_package_id' // Local key on product_snowball_settings table
        );
    }

    // Scopes
    public function scopePublished($query)
    {
        return $query->where('is_published', true);
    }

    public function scopeFeatured($query)
    {
        return $query->where('is_featured', true);
    }

    public function scopeInStock($query)
    {
        return $query->where('quantity', '>', 0);
    }

    public function scopeBySeller($query, $sellerId)
    {
        return $query->where('seller_id', $sellerId);
    }

    public function scopeByCategory($query, $categoryId)
    {
        return $query->where('category_id', $categoryId);
    }

    public function scopeWithSnowball($query)
    {
        return $query->whereHas('snowballSetting', function ($q) {
            $q->where('is_active', true);
        });
    }

    // Methods
    public function getPrimaryImageAttribute()
    {
        return $this->images->where('is_primary', true)->first() 
            ?? $this->images->first() 
            ?? null;
    }

    public function getRatingAttribute()
    {
        return $this->reviews()->avg('rating') ?: 0;
    }

    public function getReviewCountAttribute()
    {
        return $this->reviews()->count();
    }

    public function getIsInStockAttribute()
    {
        return $this->track_quantity ? $this->quantity > 0 : true;
    }

    public function getIsLowStockAttribute()
    {
        return $this->track_quantity && $this->quantity <= $this->low_stock_threshold && $this->quantity > 0;
    }

    public function getHasSnowballAttribute()
    {
        return $this->snowballSetting()->where('is_active', true)->exists();
    }

    public function getDiscountPercentageAttribute()
    {
        if ($this->compare_price > $this->price) {
            return round((($this->compare_price - $this->price) / $this->compare_price) * 100);
        }
        return 0;
    }
}
```

3. Snowball Package Model

```php
<?php
// app/Models/SnowballPackage.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class SnowballPackage extends Model
{
    use HasFactory;

    protected $fillable = [
        'name', 'slug', 'description', 'formula', 'variables', 
        'monthly_fee', 'product_limit', 'is_active'
    ];

    protected $casts = [
        'variables' => 'array',
        'monthly_fee' => 'decimal:2',
        'is_active' => 'boolean',
    ];

    // Relationships
    public function productSettings()
    {
        return $this->hasMany(ProductSnowballSetting::class);
    }

    public function commissionLogs()
    {
        return $this->hasMany(SnowballCommissionLog::class);
    }

    public function activeProducts()
    {
        return $this->hasManyThrough(
            Product::class,
            ProductSnowballSetting::class,
            'snowball_package_id',
            'id',
            'id',
            'product_id'
        )->where('product_snowball_settings.is_active', true)
         ->where('products.is_published', true);
    }

    // Scopes
    public function scopeActive($query)
    {
        return $query->where('is_active', true);
    }

    public function scopeFree($query)
    {
        return $query->where('monthly_fee', 0);
    }

    public function scopePaid($query)
    {
        return $query->where('monthly_fee', '>', 0);
    }

    // Methods
    public function getMonthlyFeeFormattedAttribute()
    {
        return number_format($this->monthly_fee, 2);
    }

    public function getVariablesParsedAttribute()
    {
        return collect($this->variables)->map(function ($variable, $key) {
            return [
                'name' => $key,
                ...$variable
            ];
        })->values();
    }

    public function calculateCommission($inputValues)
    {
        // This would be handled by the CommissionCalculator service
        // This is a simplified version
        $formula = $this->formula;
        
        foreach ($inputValues as $key => $value) {
            $formula = str_replace($key, $value, $formula);
        }

        try {
            // Using eval for demonstration - in production use a proper formula parser
            $result = eval("return $formula;");
            return max(0, $result);
        } catch (\Exception $e) {
            return 0;
        }
    }

    public function getIsUnlimitedAttribute()
    {
        return $this->product_limit === 0;
    }
}
```

---

ğŸ“ˆ Summary

Total Tables Count: ~35 Tables

```
ğŸ‘¥ User Management: 3 tables
ğŸª Vendor System: 2 tables  
ğŸ“¦ Product Catalog: 6 tables
ğŸ›’ Order System: 6 tables
â­ MLM Snowball: 5 tables
ğŸ“ Content & Reviews: 6 tables
ğŸ« Support System: 3 tables
âš™ï¸ System & Config: 4 tables
```

Key Features:

Â· âœ… Multi-vendor support with proper seller management
Â· âœ… MLM Snowball integration with flexible package system
Â· âœ… Inventory management with variant support
Â· âœ… Order splitting by vendor for commission calculation
Â· âœ… Thai address system with provinces, districts, subdistricts
Â· âœ… Comprehensive review and rating system
Â· âœ… Support ticket system for customer service
Â· âœ… Flexible system settings and service integrations

Next Steps:

1. Run migrations: php artisan migrate
2. Seed database: php artisan db:seed
3. Test relationships and factories
4. Implement business logic in services

This database schema provides a solid foundation for the Blife multi-vendor e-commerce platform with MLM capabilities!